<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Detalhes do Livro</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        /* Estilos adicionais para os detalhes do livro */
        .book-details {
            margin-top: 50px;
        }

        .book-cover {
            width: 200px;
            height: 300px;
            object-fit: cover;
        }

        .comment-input {
            margin-top: 20px;
        }

        .comment-input textarea {
            resize: vertical;
        }

        .comments-list {
            margin-top: 30px;
        }

        .comment-item {
            margin-bottom: 15px;
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>

<body>
    <div class="container book-details">
        <h1 class="text-center" style="margin-bottom: 100px; font-size: 60pt;">BooksAPI</h1>
        <a href="javascript:history.back()">--Voltar</a>
        <div style="margin-top: 50px;" class="row">
            <div class="col-md-4">
                <img src="" id="bookCover" class="book-cover" alt="Capa do Livro">
            </div>
            <div class="col-md-8">
                <h2 id="bookTitle"></h2>
                <p id="bookDescription"></p>

                <!-- Caixa de texto para inserir comentários -->
                <div class="comment-input">
                    <h4>Deixe seu comentário:</h4>
                    <textarea class="form-control" id="commentText" rows="3"></textarea>
                    <button class="btn btn-primary mt-2" id="submitComment">Enviar Comentário</button>
                </div>

                <!-- Lista de Comentários -->
                <div class="comments-list">
                    <h4>Comentários</h4>
                    <ul id="comments"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <script>
        function obtemID() {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            return urlParams.get('id');
        }

        console.log('ID do Livro:', obtemID());

        // Faz uma requisição à API do Google Books para obter detalhes do livro com base no ID
        fetch(`https://www.googleapis.com/books/v1/volumes/${obtemID()}`)
            .then(response => response.json())
            .then(data => {
                const bookInfo = data.volumeInfo;
                console.log(data);
                document.getElementById('bookTitle').innerText = bookInfo.title + " (" + bookInfo.authors.join(', ') + ")" || 'Título não disponível';
                document.getElementById('bookDescription').innerText = bookInfo.description || 'Descrição não disponível';
                document.getElementById('bookCover').src = bookInfo.imageLinks ? bookInfo.imageLinks.thumbnail : 'https://via.placeholder.com/150';
            })
            .catch(error => {
                console.error('Ocorreu um erro ao carregar os detalhes do livro:', error);
            });


        ///testes
        const commentsData = [
            { text: 'Ótimo livro!', date: '2023-11-23' },
            { text: 'Interessante, recomendo!', date: '2023-11-21' },
            { text: 'Gostei muito da leitura.', date: '2023-11-18' }
        ];

        // Função para exibir os comentários existentes
        function showComments() {
            const commentsList = document.getElementById('comments');
            commentsList.innerHTML = ''; // Limpa os comentários existentes

            commentsData.forEach(comment => {
                const commentItem = document.createElement('li');
                commentItem.classList.add('comment-item');
                commentItem.innerHTML = `
          <p>${comment.text}</p>
          <p class="text-muted">${comment.date}</p>
        `;
                commentsList.appendChild(commentItem);
            });
        }

        // Evento ao clicar no botão "Enviar Comentário"
        document.getElementById('submitComment').addEventListener('click', function () {
            const commentText = document.getElementById('commentText').value.trim();
            // Aqui você pode adicionar a lógica para enviar o comentário para um servidor ou armazená-lo localmente
            if (commentText) {
                // Simulando adição de um novo comentário
                const currentDate = new Date().toISOString().slice(0, 10);
                commentsData.push({ text: commentText, date: currentDate });
                showComments(); // Atualiza a lista de comentários após adicionar um novo
                document.getElementById('commentText').value = ''; // Limpa a caixa de texto após enviar o comentário
            } else {
                alert('Por favor, escreva seu comentário antes de enviar.');
            }
        });

        // Exibe os comentários existentes ao carregar a página
        showComments();
    </script>
</body>

</html>